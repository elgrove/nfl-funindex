{
  "//": "This file contains additional resources that Chalice is not able to manage itself. During 'make package' it is merged with the Chalice-generated tf.json file.",
  "resource": {
    "aws_lambda_function": {
      "game_scraper": {
        "//": "This block extends the block generated by Chalice, adding additional config.",
        "dead_letter_config": {
          "target_arn": "${aws_sqs_queue.scraper_dlq.arn}"
        },
        "function_name": "nfl-dev-game_scraper",
        "runtime": "python3.9",
        "handler": "app.game_scraper",
        "memory_size": 128,
        "tags": {
          "aws-chalice": "version=1.27.3:stage=dev:app=nfl"
        },
        "timeout": 60,
        "source_code_hash": "${filebase64sha256(\"${path.module}/deployment.zip\")}",
        "filename": "${path.module}/deployment.zip",
        "reserved_concurrent_executions": 1,
        "environment": {
          "variables": {
            "SCRAPE_TARGET": "https://www.pro-football-reference.com",
            "DATA_TABLE": "${aws_dynamodb_table.data_table.name}",
            "DATA_TABLE_STREAM": "${aws_dynamodb_table.data_table.stream_arn}",
            "SITE_BUCKET_ARN": "${aws_s3_bucket.nfl-site.arn}",
            "SITE_BUCKET_NAME": "${aws_s3_bucket.nfl-site.id}"
          }
        },
        "layers": [
          "${aws_lambda_layer_version.managed-layer.arn}"
        ],
        "role": "${aws_iam_role.game_scraper_role.arn}"
      },
      "checker_manual": {
        "function_name": "nfl-dev-checker_manual",
        "runtime": "python3.9",
        "handler": "app.checker_manual",
        "memory_size": 128,
        "tags": {
          "aws-chalice": "version=1.27.3:stage=dev:app=nfl"
        },
        "timeout": 60,
        "source_code_hash": "${filebase64sha256(\"${path.module}/deployment.zip\")}",
        "filename": "${path.module}/deployment.zip",
        "environment": {
          "variables": {
            "SCRAPE_TARGET": "https://www.pro-football-reference.com",
            "DATA_TABLE": "${aws_dynamodb_table.data_table.name}",
            "DATA_TABLE_STREAM": "${aws_dynamodb_table.data_table.stream_arn}",
            "SITE_BUCKET_ARN": "${aws_s3_bucket.nfl-site.arn}",
            "SITE_BUCKET_NAME": "${aws_s3_bucket.nfl-site.id}"
          }
        },
        "layers": [
          "${aws_lambda_layer_version.managed-layer.arn}"
        ],
        "role": "${aws_iam_role.checker_manual_role.arn}"
      },
      "checker": {
        "function_name": "nfl-dev-checker",
        "runtime": "python3.9",
        "handler": "app.checker",
        "memory_size": 128,
        "tags": {
          "aws-chalice": "version=1.27.3:stage=dev:app=nfl"
        },
        "timeout": 60,
        "source_code_hash": "${filebase64sha256(\"${path.module}/deployment.zip\")}",
        "filename": "${path.module}/deployment.zip",
        "environment": {
          "variables": {
            "SCRAPE_TARGET": "https://www.pro-football-reference.com",
            "DATA_TABLE": "${aws_dynamodb_table.data_table.name}",
            "DATA_TABLE_STREAM": "${aws_dynamodb_table.data_table.stream_arn}",
            "SITE_BUCKET_ARN": "${aws_s3_bucket.nfl-site.arn}",
            "SITE_BUCKET_NAME": "${aws_s3_bucket.nfl-site.id}"
          }
        },
        "layers": [
          "${aws_lambda_layer_version.managed-layer.arn}"
        ],
        "role": "${aws_iam_role.checker_role.arn}"
      },
      "site_generator": {
        "function_name": "nfl-dev-site_generator",
        "runtime": "python3.9",
        "handler": "app.site_generator",
        "memory_size": 128,
        "tags": {
          "aws-chalice": "version=1.27.3:stage=dev:app=nfl"
        },
        "timeout": 60,
        "source_code_hash": "${filebase64sha256(\"${path.module}/deployment.zip\")}",
        "filename": "${path.module}/deployment.zip",
        "environment": {
          "variables": {
            "SCRAPE_TARGET": "https://www.pro-football-reference.com",
            "DATA_TABLE": "${aws_dynamodb_table.data_table.name}",
            "DATA_TABLE_STREAM": "${aws_dynamodb_table.data_table.stream_arn}",
            "SITE_BUCKET_ARN": "${aws_s3_bucket.nfl-site.arn}",
            "SITE_BUCKET_NAME": "${aws_s3_bucket.nfl-site.id}"
          }
        },
        "layers": [
          "${aws_lambda_layer_version.managed-layer.arn}"
        ],
        "role": "${aws_iam_role.site_generator_role.arn}"
      }
    },
    "aws_lambda_layer_version": {
      "managed-layer": {
        "layer_name": "nfl-dev-managed-layer",
        "compatible_runtimes": [
          "python3.9"
        ],
        "filename": "${path.module}/layer-deployment.zip",
        "source_code_hash": "${filebase64sha256(\"${path.module}/layer-deployment.zip\")}"
      }
    },
    "aws_iam_role": {
      "checker_manual_role": {
        "name": "nfl-dev-checker_manual",
        "assume_role_policy": "{\"Version\": \"2012-10-17\", \"Statement\": [{\"Sid\": \"\", \"Effect\": \"Allow\", \"Principal\": {\"Service\": \"lambda.amazonaws.com\"}, \"Action\": \"sts:AssumeRole\"}]}"
      },
      "checker_role": {
        "name": "nfl-dev-checker",
        "assume_role_policy": "{\"Version\": \"2012-10-17\", \"Statement\": [{\"Sid\": \"\", \"Effect\": \"Allow\", \"Principal\": {\"Service\": \"lambda.amazonaws.com\"}, \"Action\": \"sts:AssumeRole\"}]}"
      },
      "game_scraper_role": {
        "name": "nfl-dev-game_scraper",
        "assume_role_policy": "{\"Version\": \"2012-10-17\", \"Statement\": [{\"Sid\": \"\", \"Effect\": \"Allow\", \"Principal\": {\"Service\": \"lambda.amazonaws.com\"}, \"Action\": \"sts:AssumeRole\"}]}"
      },
      "site_generator_role": {
        "name": "nfl-dev-site_generator",
        "assume_role_policy": "{\"Version\": \"2012-10-17\", \"Statement\": [{\"Sid\": \"\", \"Effect\": \"Allow\", \"Principal\": {\"Service\": \"lambda.amazonaws.com\"}, \"Action\": \"sts:AssumeRole\"}]}"
      }
    },
    "aws_iam_role_policy": {
      "checker_manual_role": {
        "name": "checker_manual_rolePolicy",
        "policy": "{\"Version\": \"2012-10-17\", \"Statement\": [{\"Effect\": \"Allow\", \"Action\": \"logs:CreateLogGroup\", \"Resource\": \"arn:aws:logs:eu-west-1:${data.aws_caller_identity.current.account_id}:*\"}, {\"Effect\": \"Allow\", \"Action\": [\"logs:CreateLogStream\", \"logs:PutLogEvents\"], \"Resource\": [\"arn:aws:logs:eu-west-1:${data.aws_caller_identity.current.account_id}:log-group:/aws/lambda/*\"]}, {\"Effect\": \"Allow\", \"Sid\": \"DynamoDB\", \"Action\": [\"dynamodb:BatchGet*\", \"dynamodb:DescribeStream\", \"dynamodb:DescribeTable\", \"dynamodb:Get*\", \"dynamodb:Query\", \"dynamodb:Scan\", \"dynamodb:BatchWrite*\", \"dynamodb:CreateTable\", \"dynamodb:Delete*\", \"dynamodb:Update*\", \"dynamodb:PutItem\", \"dynamodb:ListStreams\"], \"Resource\": [\"${aws_dynamodb_table.data_table.arn}\", \"${aws_dynamodb_table.data_table.arn}/index/*\", \"arn:aws:dynamodb:eu-west-1:${data.aws_caller_identity.current.account_id}:table/${aws_dynamodb_table.data_table.name}/stream/*\"]}, {\"Action\": [\"events:PutEvents\"], \"Resource\": \"arn:aws:events:eu-west-1:${data.aws_caller_identity.current.account_id}:event-bus/default\", \"Effect\": \"Allow\"}, {\"Action\": [\"events:PutEvents\"], \"Resource\": \"arn:aws:events:eu-west-1:${data.aws_caller_identity.current.account_id}:event-bus/default\", \"Effect\": \"Allow\"}, {\"Action\": [\"sqs:SendMessage\"], \"Resource\": \"${aws_sqs_queue.scraper_dlq.arn}\", \"Effect\": \"Allow\"}, {\"Action\": [\"s3:PutObject\", \"s3:GetObject\", \"s3:DeleteObject\"], \"Resource\": \"${aws_s3_bucket.nfl-site.arn}/*\", \"Effect\": \"Allow\"}]}",
        "role": "${aws_iam_role.checker_manual_role.id}"
      },
      "checker_role": {
        "name": "checker_rolePolicy",
        "policy": "{\"Version\": \"2012-10-17\", \"Statement\": [{\"Effect\": \"Allow\", \"Action\": \"logs:CreateLogGroup\", \"Resource\": \"arn:aws:logs:eu-west-1:${data.aws_caller_identity.current.account_id}:*\"}, {\"Effect\": \"Allow\", \"Action\": [\"logs:CreateLogStream\", \"logs:PutLogEvents\"], \"Resource\": [\"arn:aws:logs:eu-west-1:${data.aws_caller_identity.current.account_id}:log-group:/aws/lambda/*\"]}, {\"Effect\": \"Allow\", \"Sid\": \"DynamoDB\", \"Action\": [\"dynamodb:BatchGet*\", \"dynamodb:DescribeStream\", \"dynamodb:DescribeTable\", \"dynamodb:Get*\", \"dynamodb:Query\", \"dynamodb:Scan\", \"dynamodb:BatchWrite*\", \"dynamodb:CreateTable\", \"dynamodb:Delete*\", \"dynamodb:Update*\", \"dynamodb:PutItem\", \"dynamodb:ListStreams\"], \"Resource\": [\"${aws_dynamodb_table.data_table.arn}\", \"${aws_dynamodb_table.data_table.arn}/index/*\", \"arn:aws:dynamodb:eu-west-1:${data.aws_caller_identity.current.account_id}:table/${aws_dynamodb_table.data_table.name}/stream/*\"]}, {\"Action\": [\"events:PutEvents\"], \"Resource\": \"arn:aws:events:eu-west-1:${data.aws_caller_identity.current.account_id}:event-bus/default\", \"Effect\": \"Allow\"}, {\"Action\": [\"events:PutEvents\"], \"Resource\": \"arn:aws:events:eu-west-1:${data.aws_caller_identity.current.account_id}:event-bus/default\", \"Effect\": \"Allow\"}, {\"Action\": [\"sqs:SendMessage\"], \"Resource\": \"${aws_sqs_queue.scraper_dlq.arn}\", \"Effect\": \"Allow\"}, {\"Action\": [\"s3:PutObject\", \"s3:GetObject\", \"s3:DeleteObject\"], \"Resource\": \"${aws_s3_bucket.nfl-site.arn}/*\", \"Effect\": \"Allow\"}]}",
        "role": "${aws_iam_role.checker_role.id}"
      },
      "game_scraper_role": {
        "name": "game_scraper_rolePolicy",
        "policy": "{\"Version\": \"2012-10-17\", \"Statement\": [{\"Effect\": \"Allow\", \"Action\": \"logs:CreateLogGroup\", \"Resource\": \"arn:aws:logs:eu-west-1:${data.aws_caller_identity.current.account_id}:*\"}, {\"Effect\": \"Allow\", \"Action\": [\"logs:CreateLogStream\", \"logs:PutLogEvents\"], \"Resource\": [\"arn:aws:logs:eu-west-1:${data.aws_caller_identity.current.account_id}:log-group:/aws/lambda/*\"]}, {\"Effect\": \"Allow\", \"Sid\": \"DynamoDB\", \"Action\": [\"dynamodb:BatchGet*\", \"dynamodb:DescribeStream\", \"dynamodb:DescribeTable\", \"dynamodb:Get*\", \"dynamodb:Query\", \"dynamodb:Scan\", \"dynamodb:BatchWrite*\", \"dynamodb:CreateTable\", \"dynamodb:Delete*\", \"dynamodb:Update*\", \"dynamodb:PutItem\", \"dynamodb:ListStreams\"], \"Resource\": [\"${aws_dynamodb_table.data_table.arn}\", \"${aws_dynamodb_table.data_table.arn}/index/*\", \"arn:aws:dynamodb:eu-west-1:${data.aws_caller_identity.current.account_id}:table/${aws_dynamodb_table.data_table.name}/stream/*\"]}, {\"Action\": [\"events:PutEvents\"], \"Resource\": \"arn:aws:events:eu-west-1:${data.aws_caller_identity.current.account_id}:event-bus/default\", \"Effect\": \"Allow\"}, {\"Action\": [\"events:PutEvents\"], \"Resource\": \"arn:aws:events:eu-west-1:${data.aws_caller_identity.current.account_id}:event-bus/default\", \"Effect\": \"Allow\"}, {\"Action\": [\"sqs:SendMessage\"], \"Resource\": \"${aws_sqs_queue.scraper_dlq.arn}\", \"Effect\": \"Allow\"}, {\"Action\": [\"s3:PutObject\", \"s3:GetObject\", \"s3:DeleteObject\"], \"Resource\": \"${aws_s3_bucket.nfl-site.arn}/*\", \"Effect\": \"Allow\"}]}",
        "role": "${aws_iam_role.game_scraper_role.id}"
      },
      "site_generator_role": {
        "name": "site_generator_rolePolicy",
        "policy": "{\"Version\": \"2012-10-17\", \"Statement\": [{\"Effect\": \"Allow\", \"Action\": \"logs:CreateLogGroup\", \"Resource\": \"arn:aws:logs:eu-west-1:${data.aws_caller_identity.current.account_id}:*\"}, {\"Effect\": \"Allow\", \"Action\": [\"logs:CreateLogStream\", \"logs:PutLogEvents\"], \"Resource\": [\"arn:aws:logs:eu-west-1:${data.aws_caller_identity.current.account_id}:log-group:/aws/lambda/*\"]}, {\"Effect\": \"Allow\", \"Sid\": \"DynamoDB\", \"Action\": [\"dynamodb:BatchGet*\", \"dynamodb:DescribeStream\", \"dynamodb:DescribeTable\", \"dynamodb:Get*\", \"dynamodb:Query\", \"dynamodb:Scan\", \"dynamodb:BatchWrite*\", \"dynamodb:CreateTable\", \"dynamodb:Delete*\", \"dynamodb:Update*\", \"dynamodb:PutItem\", \"dynamodb:ListStreams\"], \"Resource\": [\"${aws_dynamodb_table.data_table.arn}\", \"${aws_dynamodb_table.data_table.arn}/index/*\", \"arn:aws:dynamodb:eu-west-1:${data.aws_caller_identity.current.account_id}:table/${aws_dynamodb_table.data_table.name}/stream/*\"]}, {\"Action\": [\"events:PutEvents\"], \"Resource\": \"arn:aws:events:eu-west-1:${data.aws_caller_identity.current.account_id}:event-bus/default\", \"Effect\": \"Allow\"}, {\"Action\": [\"events:PutEvents\"], \"Resource\": \"arn:aws:events:eu-west-1:${data.aws_caller_identity.current.account_id}:event-bus/default\", \"Effect\": \"Allow\"}, {\"Action\": [\"sqs:SendMessage\"], \"Resource\": \"${aws_sqs_queue.scraper_dlq.arn}\", \"Effect\": \"Allow\"}, {\"Action\": [\"s3:PutObject\", \"s3:GetObject\", \"s3:DeleteObject\"], \"Resource\": \"${aws_s3_bucket.nfl-site.arn}/*\", \"Effect\": \"Allow\"}]}",
        "role": "${aws_iam_role.site_generator_role.id}"
      }
    },
    "aws_cloudwatch_event_rule": {
      "checker-event": {
        "name": "checker-event",
        "schedule_expression": "rate(2 hours)",
        "description": ""
      },
      "game_scraper-event": {
        "name": "game_scraper-event",
        "event_pattern": "{\"detail-type\": [\"game_to_scrape\"]}"
      }
    },
    "aws_cloudwatch_event_target": {
      "checker-event": {
        "rule": "${aws_cloudwatch_event_rule.checker-event.name}",
        "target_id": "checker-event",
        "arn": "${aws_lambda_function.checker.arn}"
      },
      "game_scraper-event": {
        "rule": "${aws_cloudwatch_event_rule.game_scraper-event.name}",
        "target_id": "game_scraper-event",
        "arn": "${aws_lambda_function.game_scraper.arn}"
      }
    },
    "aws_lambda_permission": {
      "checker-event": {
        "function_name": "${aws_lambda_function.checker.arn}",
        "action": "lambda:InvokeFunction",
        "principal": "events.amazonaws.com",
        "source_arn": "${aws_cloudwatch_event_rule.checker-event.arn}"
      },
      "game_scraper-event": {
        "function_name": "${aws_lambda_function.game_scraper.arn}",
        "action": "lambda:InvokeFunction",
        "principal": "events.amazonaws.com",
        "source_arn": "${aws_cloudwatch_event_rule.game_scraper-event.arn}"
      }
    },
    "aws_lambda_event_source_mapping": {
      "site_generator-dynamodb-event-source": {
        "event_source_arn": "${aws_dynamodb_table.data_table.stream_arn}",
        "batch_size": 100,
        "starting_position": "LATEST",
        "maximum_batching_window_in_seconds": 0,
        "function_name": "${aws_lambda_function.site_generator.arn}"
      }
    }
  },
  "locals": {},
  "data": {
    "aws_caller_identity": {
      "chalice": {}
    },
    "aws_partition": {
      "chalice": {}
    },
    "aws_region": {
      "chalice": {}
    },
    "null_data_source": {
      "chalice": {
        "inputs": {
          "app": "nfl",
          "stage": "dev"
        }
      }
    }
  }
}